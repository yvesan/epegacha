import React, { useState } from 'react';

export const DatabaseSetupGuide: React.FC = () => {
  const [isOpen, setIsOpen] = useState(false);

  const step1Sql = `
-- âš ï¸ ç¬¬ä¸€æ­¥ï¼šå»ºç«‹è¡¨æ ¼ (RUN è¿è¡Œä¸€æ¬¡å³å¯)

drop table if exists records;
drop table if exists users;

-- 1. åˆ›å»ºè®°å½•è¡¨
create table records (
  id bigint generated by default as identity primary key,
  user_name text not null,
  prize_name text not null,
  prize_type text not null,
  prize_value int default 0,
  is_redeemed boolean default false,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- 2. åˆ›å»ºç”¨æˆ·è¡¨ (è®¾ç½® name ä¸ºå”¯ä¸€ï¼Œé˜²æ­¢åŒä¸€ä¸ªäººæœ‰ä¸¤ä¸ªè´¦å·)
create table users (
  id bigint generated by default as identity primary key,
  name text not null,
  points int default 0, 
  fragment_500 int default 0,
  fragment_free int default 0,
  created_at timestamp with time zone default timezone('utc'::text, now()),
  unique(name)
);

-- 3. å¼€å¯æƒé™ (å…è®¸æ‰€æœ‰è¯»å†™ï¼Œç®€å•ç²—æš´)
alter table records enable row level security;
create policy "Allow all access" on records for all using (true) with check (true);

alter table users enable row level security;
create policy "Allow all access" on users for all using (true) with check (true);
  `;

  const step2Sql = `
-- âš ï¸ ç¬¬äºŒæ­¥ï¼šå¯¼å…¥å­¦å‘˜ç§¯åˆ†æ•°æ®
-- è¯·å°†ä¸‹é¢çš„ ('å§“å', ç§¯åˆ†) æ›¿æ¢ä¸ºæ‚¨ Excel é‡Œçš„çœŸå®æ•°æ®
-- æ³¨æ„ï¼šæœ€åä¸€ä¸ªä¸ç”¨åŠ é€—å·ï¼Œå‰é¢çš„æ¯è¡Œéƒ½è¦åŠ é€—å·

insert into users (name, points) values 
  ('å¼ ä¸‰', 300),
  ('æå››', 60),
  ('ç‹äº”', 1500),
  ('é™ˆå…­', 30)
on conflict (name) do update 
set points = excluded.points;

-- ç‚¹å‡» RUN ä¹‹åï¼Œè¿™äº›ç”¨æˆ·å°±è¿›å»äº†
  `;

  if (!isOpen) {
    return (
      <button 
        onClick={() => setIsOpen(true)}
        className="fixed bottom-4 right-4 bg-red-600 text-white px-4 py-2 rounded-full shadow-lg z-50 text-sm animate-bounce font-bold border-2 border-white"
      >
        ğŸ†˜ å¿…çœ‹ï¼šæ•°æ®åº“å®‰è£…æŒ‡å—
      </button>
    );
  }

  return (
    <div className="fixed inset-0 bg-black/95 z-50 overflow-y-auto p-4 flex items-center justify-center">
      <div className="bg-gray-900 text-white rounded-xl border border-gray-700 p-6 max-w-3xl w-full shadow-2xl">
        <div className="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
            <h2 className="text-2xl font-bold text-epe-blue">ğŸš€ æ•°æ®åº“è®¾ç½®å‘å¯¼ (åˆ†ä¸¤æ­¥èµ°)</h2>
            <button onClick={() => setIsOpen(false)} className="text-gray-400 hover:text-white">âœ•</button>
        </div>
        
        <div className="space-y-8">
            {/* Step 1 */}
            <div>
                <div className="flex items-center gap-2 mb-2">
                    <span className="bg-epe-blue text-black font-bold px-2 py-1 rounded text-sm">æ­¥éª¤ 1</span>
                    <h3 className="font-bold text-lg">å»ºç«‹è¡¨æ ¼ç»“æ„</h3>
                </div>
                <p className="text-sm text-gray-400 mb-2">å°†è¿™æ®µä»£ç å¤åˆ¶åˆ° Supabase SQL Editor å¹¶ç‚¹å‡» <strong className="text-green-400">Run</strong>ã€‚</p>
                <div className="relative">
                    <textarea readOnly className="w-full h-32 bg-black border border-gray-700 text-green-400 p-3 text-xs font-mono rounded" value={step1Sql.trim()} />
                    <button 
                        onClick={() => navigator.clipboard.writeText(step1Sql.trim())}
                        className="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-white px-2 py-1 text-xs rounded transition"
                    >
                        å¤åˆ¶ Step 1 ä»£ç 
                    </button>
                </div>
            </div>

            {/* Step 2 */}
            <div>
                <div className="flex items-center gap-2 mb-2">
                    <span className="bg-epe-purple text-white font-bold px-2 py-1 rounded text-sm">æ­¥éª¤ 2</span>
                    <h3 className="font-bold text-lg">æ‰¹é‡å¯¼å…¥å­¦å‘˜åå•</h3>
                </div>
                <p className="text-sm text-gray-400 mb-2">
                    1. å°†æ‚¨çš„ Excel è¡¨æ ¼æ•´ç†æˆ <code className="text-yellow-400">('å§“å', ç§¯åˆ†),</code> çš„æ ¼å¼ã€‚<br/>
                    2. æ›¿æ¢ä¸‹é¢çš„ values éƒ¨åˆ†ã€‚<br/>
                    3. è¿è¡Œä»£ç ã€‚è¿™æ ·æ‰€æœ‰å­¦å‘˜çš„æ•°æ®å°±ä¸€æ¬¡æ€§è¿›å»äº†ã€‚
                </p>
                <div className="relative">
                    <textarea readOnly className="w-full h-40 bg-black border border-gray-700 text-purple-300 p-3 text-xs font-mono rounded" value={step2Sql.trim()} />
                    <button 
                        onClick={() => navigator.clipboard.writeText(step2Sql.trim())}
                        className="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-white px-2 py-1 text-xs rounded transition"
                    >
                        å¤åˆ¶ Step 2 æ¨¡æ¿
                    </button>
                </div>
            </div>
        </div>

        <div className="mt-8 pt-4 border-t border-gray-700 flex justify-end">
            <button 
                onClick={() => setIsOpen(false)}
                className="bg-epe-blue hover:bg-cyan-400 text-black font-bold py-2 px-6 rounded-lg transition"
            >
                æ˜ç™½äº†ï¼Œå»æ“ä½œ
            </button>
        </div>
      </div>
    </div>
  );
};